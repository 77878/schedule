<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™ºèƒ½æ’ç­ç³»çµ± V1.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0b1120; color: #f1f5f9; font-family: system-ui, sans-serif; }
        .card { background-color: #1e293b; border-radius: 16px; padding: 1rem; border: 1px solid #334155; }
        select { 
            background: #0f172a; border: 1px solid #475569; border-radius: 8px; padding: 6px; 
            color: #38bdf8; width: 100%; font-weight: bold; appearance: none;
        }
        .status-pill { font-size: 0.7rem; padding: 2px 8px; rounded: 99px; }
        .warning { color: #f87171; font-weight: bold; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="p-4 pb-12">
    <div class="max-w-md mx-auto space-y-4">
        
        <div class="flex justify-between items-end">
            <div>
                <h1 class="text-2xl font-black text-white">æ’ç­æˆ°æƒ…å®¤</h1>
                <p class="text-xs text-slate-400">é›¶å”®é¤é£²å°ˆç”¨æ¨¡çµ„</p>
            </div>
            <div class="text-right">
                <span class="block text-[10px] text-slate-500 font-bold uppercase">ä»Šæ—¥ç‹€æ…‹</span>
                <span id="global_status" class="text-emerald-400 font-bold">ç¬¦åˆè¦ç¯„</span>
            </div>
        </div>

        <div class="card">
            <h2 class="text-[10px] font-black text-blue-400 uppercase italic mb-3">ç•¶å‰è«‹å‡/ä¸å…‹åƒåŠ </h2>
            <div class="flex gap-2 overflow-x-auto pb-2" id="leave_toggles">
                </div>
        </div>

        <div class="space-y-3">
            <div class="card border-l-4 border-l-sky-500">
                <div class="flex justify-between items-center mb-2">
                    <span class="font-black text-sky-400">æ—©ç­ (MORNING)</span>
                    <span class="text-[10px] text-slate-500">08:00 - 12:00</span>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <div><label class="text-[9px] text-slate-500">æ«ƒå° (A)</label><select id="shift_1_A" onchange="validate()"></select></div>
                    <div><label class="text-[9px] text-slate-500">å…§å ´ (B)</label><select id="shift_1_B" onchange="validate()"></select></div>
                    <div><label class="text-[9px] text-slate-500">å¤–å ´ (T)</label><select id="shift_1_T" onchange="validate()"></select></div>
                </div>
            </div>

            <div class="card border-l-4 border-l-amber-500">
                <div class="flex justify-between items-center mb-2">
                    <span class="font-black text-amber-500">åˆç­ (AFTERNOON)</span>
                    <span class="text-[10px] text-slate-500">12:00 - 17:00</span>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <div><label class="text-[9px] text-slate-500">æ«ƒå° (A)</label><select id="shift_2_A" onchange="validate()"></select></div>
                    <div><label class="text-[9px] text-slate-500">å…§å ´ (B)</label><select id="shift_2_B" onchange="validate()"></select></div>
                    <div><label class="text-[9px] text-slate-500">å¤–å ´ (T)</label><select id="shift_2_T" onchange="validate()"></select></div>
                </div>
            </div>

            <div class="card border-l-4 border-l-indigo-500">
                <div class="flex justify-between items-center mb-2">
                    <span class="font-black text-indigo-400">æ™šç­ (EVENING)</span>
                    <span class="text-[10px] text-slate-500">17:00 - 22:00</span>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <div><label class="text-[9px] text-slate-500">æ«ƒå° (A)</label><select id="shift_3_A" onchange="validate()"></select></div>
                    <div><label class="text-[9px] text-slate-500">å…§å ´ (B)</label><select id="shift_3_B" onchange="validate()"></select></div>
                    <div><label class="text-[9px] text-slate-500">å¤–å ´ (T)</label><select id="shift_3_T" onchange="validate()"></select></div>
                </div>
            </div>
        </div>

        <div id="alert_panel" class="card bg-red-900/10 border-red-500/30 hidden">
            <h3 class="text-[10px] font-black text-red-400 italic mb-2">âš  æ’ç­è¡çªè­¦å ±</h3>
            <ul id="alert_list" class="text-xs space-y-1 text-red-300"></ul>
        </div>

        <div class="card">
            <h3 class="text-[10px] font-black text-slate-400 italic mb-3">ä»Šæ—¥å·¥æ™‚æ¦‚è¦½ (ç­æ¬¡æ•¸)</h3>
            <div id="stats_panel" class="flex justify-between">
                </div>
        </div>

    </div>

    <script>
        const staff = ["ç„¡", "å“¡å·¥1", "å“¡å·¥2", "å“¡å·¥3", "å“¡å·¥4", "å“¡å·¥5"];
        const leaves = new Set();

        function init() {
            // åˆå§‹åŒ–ä¸‹æ‹‰é¸å–®
            const selects = document.querySelectorAll('select');
            selects.forEach(s => {
                staff.forEach(name => {
                    const opt = document.createElement('option');
                    opt.value = name;
                    opt.innerText = name;
                    s.appendChild(opt);
                });
            });

            // åˆå§‹åŒ–å‡è¡¨åˆ‡æ›æŒ‰éˆ•
            const leaveBox = document.getElementById('leave_toggles');
            staff.slice(1).forEach(name => {
                const btn = document.createElement('button');
                btn.innerText = name;
                btn.className = "px-3 py-1 rounded-lg bg-slate-800 text-[10px] font-bold border border-slate-700 flex-shrink-0";
                btn.onclick = () => {
                    if(leaves.has(name)) {
                        leaves.delete(name);
                        btn.classList.replace('bg-red-500/20', 'bg-slate-800');
                        btn.classList.replace('border-red-500', 'border-slate-700');
                    } else {
                        leaves.add(name);
                        btn.classList.replace('bg-slate-800', 'bg-red-500/20');
                        btn.classList.replace('border-slate-700', 'border-red-500');
                    }
                    validate();
                };
                leaveBox.appendChild(btn);
            });
            validate();
        }

        function validate() {
            const alerts = [];
            const countMap = {};
            staff.slice(1).forEach(name => countMap[name] = 0);

            const selects = document.querySelectorAll('select');
            selects.forEach(s => {
                const val = s.value;
                if(val !== "ç„¡") {
                    countMap[val]++;
                    // æª¢æŸ¥æ˜¯å¦è«‹å‡ä¸­
                    if(leaves.has(val)) {
                        alerts.push(`ğŸš« ${val} ä»Šæ—¥è«‹å‡ä¸­ï¼Œä¸å¯æ’ç­`);
                        s.style.borderColor = "#ef4444";
                    } else {
                        s.style.borderColor = "#475569";
                    }
                }
            });

            // æª¢æŸ¥å–®äººé›™ç­é™åˆ¶
            staff.slice(1).forEach(name => {
                if(countMap[name] > 2) {
                    alerts.push(`âš ï¸ ${name} è¶…é‡ï¼šä»Šæ—¥å·²æ’ ${countMap[name]} å€‹ç­ (ä¸Šé™ 2)`);
                }
            });

            // æ›´æ–°è­¦å ±é¡¯ç¤º
            const alertPanel = document.getElementById('alert_panel');
            const alertList = document.getElementById('alert_list');
            const globalStatus = document.getElementById('global_status');
            
            if(alerts.length > 0) {
                alertPanel.classList.remove('hidden');
                alertList.innerHTML = alerts.map(a => `<li>${a}</li>`).join('');
                globalStatus.innerText = "é•åè¦ç¯„";
                globalStatus.className = "text-red-400 font-bold animate-pulse";
            } else {
                alertPanel.classList.add('hidden');
                globalStatus.innerText = "ç¬¦åˆè¦ç¯„";
                globalStatus.className = "text-emerald-400 font-bold";
            }

            // æ›´æ–°çµ±è¨ˆ
            const statsPanel = document.getElementById('stats_panel');
            statsPanel.innerHTML = staff.slice(1).map(name => `
                <div class="text-center">
                    <p class="text-[9px] text-slate-500">${name}</p>
                    <p class="font-black ${countMap[name]>2?'text-red-500':'text-white'}">${countMap[name]}</p>
                </div>
            `).join('');
        }

        window.onload = init;
    </script>
</body>
</html>
