<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™ºèƒ½æ’ç­ç³»çµ± V1.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0b1120; color: #f1f5f9; font-family: system-ui, sans-serif; -webkit-tap-highlight-color: transparent; }
        .card { background-color: #1e293b; border-radius: 16px; padding: 1rem; border: 1px solid #334155; }
        select { 
            background: #0f172a; border: 1px solid #475569; border-radius: 8px; padding: 6px; 
            color: #38bdf8; width: 100%; font-weight: bold; appearance: none; font-size: 0.9rem;
        }
        .btn-magic {
            background: linear-gradient(135deg, #38bdf8 0%, #818cf8 100%);
            box-shadow: 0 4px 15px rgba(56, 189, 248, 0.2);
        }
        .btn-magic:active { transform: scale(0.95); }
        .warning { color: #f87171; font-weight: bold; }
    </style>
</head>
<body class="p-4 pb-12">
    <div class="max-w-md mx-auto space-y-4">
        
        <div class="flex justify-between items-start">
            <div>
                <h1 class="text-2xl font-black text-white">æ’ç­æˆ°æƒ…å®¤</h1>
                <p id="global_status" class="text-[10px] text-emerald-400 font-bold uppercase tracking-widest">ç³»çµ±é‹è¡Œæ­£å¸¸</p>
            </div>
            <button onclick="autoSchedule()" class="btn-magic text-white text-[10px] font-black px-4 py-2 rounded-xl uppercase italic">
                âœ¨ è‡ªå‹•æ’ç­
            </button>
        </div>

        <div class="card">
            <h2 class="text-[10px] font-black text-blue-400 uppercase italic mb-3">ä»Šæ—¥å…¬ä¼‘äººå“¡ (é»æ“Šåˆ‡æ›)</h2>
            <div class="flex gap-2 overflow-x-auto pb-1" id="leave_toggles"></div>
        </div>

        <div class="space-y-3" id="shift_container">
            <div class="card border-l-4 border-l-sky-500">
                <div class="flex justify-between items-center mb-2">
                    <span class="font-black text-sky-400">æ—©ç­ (MORNING)</span>
                    <span class="text-[10px] text-slate-500">08:00 - 12:00</span>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <div><label class="text-[9px] text-slate-500">æ«ƒå° (A)</label><select id="s1_A" onchange="validate()"></select></div>
                    <div><label class="text-[9px] text-slate-500">å…§å ´ (B)</label><select id="s1_B" onchange="validate()"></select></div>
                    <div><label class="text-[9px] text-slate-500">å¤–å ´ (T)</label><select id="s1_T" onchange="validate()"></select></div>
                </div>
            </div>

            <div class="card border-l-4 border-l-amber-500">
                <div class="flex justify-between items-center mb-2">
                    <span class="font-black text-amber-500">åˆç­ (AFTERNOON)</span>
                    <span class="text-[10px] text-slate-500">12:00 - 17:00</span>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <div><label class="text-[9px] text-slate-500">æ«ƒå° (A)</label><select id="s2_A" onchange="validate()"></select></div>
                    <div><label class="text-[9px] text-slate-500">å…§å ´ (B)</label><select id="s2_B" onchange="validate()"></select></div>
                    <div><label class="text-[9px] text-slate-500">å¤–å ´ (T)</label><select id="s2_T" onchange="validate()"></select></div>
                </div>
            </div>

            <div class="card border-l-4 border-l-indigo-500">
                <div class="flex justify-between items-center mb-2">
                    <span class="font-black text-indigo-400">æ™šç­ (EVENING)</span>
                    <span class="text-[10px] text-slate-500">17:00 - 22:00</span>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <div><label class="text-[9px] text-slate-500">æ«ƒå° (A)</label><select id="s3_A" onchange="validate()"></select></div>
                    <div><label class="text-[9px] text-slate-500">å…§å ´ (B)</label><select id="s3_B" onchange="validate()"></select></div>
                    <div><label class="text-[9px] text-slate-500">å¤–å ´ (T)</label><select id="s3_T" onchange="validate()"></select></div>
                </div>
            </div>
        </div>

        <div id="alert_panel" class="card bg-red-900/10 border-red-500/30 hidden">
            <ul id="alert_list" class="text-[11px] space-y-1 text-red-400 font-bold"></ul>
        </div>

        <div class="card">
            <h3 class="text-[10px] font-black text-slate-400 italic mb-3">ä»Šæ—¥æ’ç­æ¬¡æ•¸çµ±è¨ˆ (ä¸Šé™ 2)</h3>
            <div id="stats_panel" class="flex justify-between"></div>
        </div>
    </div>

    <script>
        const staffList = ["å“¡å·¥A", "å“¡å·¥B", "å“¡å·¥C", "å“¡å·¥D", "å“¡å·¥E"];
        const leaves = new Set();
        const selectIds = ["s1_A", "s1_B", "s1_T", "s2_A", "s2_B", "s2_T", "s3_A", "s3_B", "s3_T"];

        function init() {
            selectIds.forEach(id => {
                const s = document.getElementById(id);
                const noneOpt = document.createElement('option');
                noneOpt.value = "ç„¡"; noneOpt.innerText = "ç„¡";
                s.appendChild(noneOpt);
                staffList.forEach(name => {
                    const opt = document.createElement('option');
                    opt.value = name; opt.innerText = name;
                    s.appendChild(opt);
                });
            });

            const leaveBox = document.getElementById('leave_toggles');
            staffList.forEach(name => {
                const btn = document.createElement('button');
                btn.id = `btn_${name}`;
                btn.innerText = name;
                btn.className = "px-3 py-1 rounded-lg bg-slate-800 text-[10px] font-bold border border-slate-700 flex-shrink-0 transition-all";
                btn.onclick = () => toggleLeave(name);
                leaveBox.appendChild(btn);
            });
            validate();
        }

        function toggleLeave(name) {
            const btn = document.getElementById(`btn_${name}`);
            if(leaves.has(name)) {
                leaves.delete(name);
                btn.classList.remove('bg-red-500/20', 'border-red-500', 'text-red-400');
                btn.classList.add('bg-slate-800', 'border-slate-700');
            } else {
                leaves.add(name);
                btn.classList.add('bg-red-500/20', 'border-red-500', 'text-red-400');
                btn.classList.remove('bg-slate-800', 'border-slate-700');
            }
            validate();
        }

        function autoSchedule() {
            // ç²å–ç›®å‰æ²’è«‹å‡çš„äººå“¡ä¸¦éš¨æ©Ÿæ‰“äº‚
            let available = staffList.filter(name => !leaves.has(name));
            if (available.length < 3) {
                alert("åœ¨å ´äººå“¡ä¸è¶³ 3 äººï¼Œç„¡æ³•å®Œæˆæ’ç­ï¼");
                return;
            }

            const countMap = {};
            available.forEach(n => countMap[n] = 0);

            // å®šç¾©ç­æ¬¡çµ„åˆ¥
            const shifts = [
                ["s1_A", "s1_B", "s1_T"], // æ—©ç­
                ["s2_A", "s2_B", "s2_T"], // åˆç­
                ["s3_A", "s3_B", "s3_T"]  // æ™šç­
            ];

            shifts.forEach(group => {
                let pool = [...available].sort(() => Math.random() - 0.5);
                let selectedForShift = [];

                group.forEach(id => {
                    // æŒ‘é¸ä»Šå¤©ä¸Šæœ€å°‘ç­ï¼Œä¸”é€™ç­é‚„æ²’ä¸Šçš„äºº
                    const candidate = pool.find(n => !selectedForShift.includes(n) && countMap[n] < 2);
                    if (candidate) {
                        document.getElementById(id).value = candidate;
                        countMap[candidate]++;
                        selectedForShift.push(candidate);
                    } else {
                        document.getElementById(id).value = "ç„¡";
                    }
                });
            });
            validate();
        }

        function validate() {
            const alerts = [];
            const countMap = {};
            staffList.forEach(n => countMap[n] = 0);

            selectIds.forEach(id => {
                const s = document.getElementById(id);
                const val = s.value;
                s.style.borderColor = "#475569";
                if(val !== "ç„¡") {
                    countMap[val]++;
                    if(leaves.has(val)) {
                        alerts.push(`ğŸš« ${val} è«‹å‡ä¸­å»è¢«æ’å…¥ ${id.replace('s','ç­æ¬¡').replace('_','-')}`);
                        s.style.borderColor = "#ef4444";
                    }
                }
            });

            staffList.forEach(name => {
                if(countMap[name] > 2) alerts.push(`âš ï¸ ${name} è² æ“”éé‡ï¼šå·²æ’ ${countMap[name]} ç­`);
            });

            const alertPanel = document.getElementById('alert_panel');
            const alertList = document.getElementById('alert_list');
            const globalStatus = document.getElementById('global_status');
            
            if(alerts.length > 0) {
                alertPanel.classList.remove('hidden');
                alertList.innerHTML = alerts.map(a => `<li>${a}</li>`).join('');
                globalStatus.innerText = "âš  ç™¼ç¾æ’ç­è¡çª";
                globalStatus.className = "text-red-400 font-bold uppercase tracking-widest";
            } else {
                alertPanel.classList.add('hidden');
                globalStatus.innerText = "ç³»çµ±é‹è¡Œæ­£å¸¸";
                globalStatus.className = "text-emerald-400 font-bold uppercase tracking-widest";
            }

            const statsPanel = document.getElementById('stats_panel');
            statsPanel.innerHTML = staffList.map(name => `
                <div class="text-center">
                    <p class="text-[9px] text-slate-500">${name}</p>
                    <p class="font-black ${countMap[name]>2?'text-red-500':'text-white'}">${countMap[name]}</p>
                </div>
            `).join('');
        }

        window.onload = init;
    </script>
</body>
</html>
